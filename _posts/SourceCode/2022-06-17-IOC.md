---
layout: post
title: sping里的工厂模式BeanFactory --IOC
---

## 一、工厂的核心功能

生活中的工厂是什么？

工厂里有不同车间，同一车间生产同一种类的商品，不同的车间生产不同种类的商品。我们需要什么商品，就去工厂里购入，工厂再通知该商品的车间生产。如果没有这些车间呢？就成立一个车间，再生产。

spring的基本对象就是bean（商品），Bean太常用，每次声明都不好管理。就用BeanFactory来管理，但BeanFactory里的Bean大而全，没必要每次都声明全部Bean，因此用到什么类型的Bean，就在BeanFactory里声明。

## 二、实际例子

举例说明一次调用 BeanFactory 实现 IOC 的过程。准备（工程结构）：

```
IOC
 |---- java.fun.zhaotong.IOC
          |---- A.java
          |---- ZTBeanFactoryPostProcessor.java
          |---- ZTTest.java
 |---- resource
          |---- zttest.xml
```

##### 1、设置Bean原型

```java
public class A {
    private String name;

    public void init() {
        System.out.println("init:" + this.name);
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

##### 2、zttest.xml声明要调用到的Bean，并实例化，填充属性值

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="a" class="fun.zhaotong.A" init-method="init">
        <property name="name" value="zhangsan"></property>
    </bean>
    <bean class="fun.zhaotong.ZTBeanFactoryPostProcessor"></bean>
</beans>
```

##### 3、构造器声明实例化BeanFactory，初始化Bean

```java
public class ZTBeanFactoryPostProcessor implements BeanFactoryPostProcessor {
    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
        BeanDefinition a = beanFactory.getBeanDefinition("a");
        System.out.println("设置BeanDefinition");
    }
}
```

##### 4、实例化Bean

```java
public class ZTTest {
    public static void main(String[] args) {
        ApplicationContext context = new ClassPathXmlApplicationContext("zttest.xml");
        A bean = context.getBean(A.class);
        System.out.println("ZTTest:" + bean.getName());
    }
}
```

##### 5、调用，打印结果

```
> Task :IOC:ZTTest.main()
设置BeanDefinition
init:zhangsan
ZTTest:zhangsan
```

## 三、spring里的一些说明

生产BeanFactory时实现的接口是BeanFactoryPostProcessor，BeanFactory是Bean工厂的意思，PostProcessor是后置处理器，是Bean工厂的增强器，以实现更丰富的功能。

